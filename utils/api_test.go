package utils

import (
	"testing"
)

func TestApiResponseParsing(t *testing.T) {
	body := []byte(`{"datatable":{"data":[["AAPL","2017-10-31",167.9,169.6499,166.94,169.04,36046828.0,0.0,1.0,39.7185241428073,40.1324815305231,39.4914259702218,39.9882032227525,144187312.0],["AAPL","2017-10-30",163.89,168.07,163.72,166.72,44700772.0,0.0,1.0,38.7699161510702,39.7587394442026,38.7297008496748,39.4393826390043,178803088.0],["AAPL","2017-10-27",159.29,163.6,158.7,163.05,44454160.0,0.0,1.0,37.6817374074316,38.7013135781016,37.5421666555301,38.5712052500579,177816640.0],["AAPL","2017-10-26",157.23,157.8295,156.78,157.41,17000469.0,0.0,1.0,37.1944225787587,37.3362406563264,37.0879703103593,37.2370034861185,68001876.0],["AAPL","2017-10-25",156.91,157.55,155.27,156.41,21207098.0,0.0,1.0,37.1187231878969,37.2701219696205,36.7307638097301,37.0004428896753,84828392.0],["AAPL","2017-10-24",156.29,157.42,156.2,157.1,17757230.0,0.0,1.0,36.9720556181021,37.2393690920829,36.9507651644222,37.1636697012211,71028920.0],["AAPL","2017-10-23",156.89,157.69,155.5,156.17,21984327.0,0.0,1.0,37.113991975968,37.3032404531225,36.785172746912,36.9436683465289,87937308.0],["AAPL","2017-10-20",156.61,157.75,155.96,156.25,23974146.0,0.0,1.0,37.0477550089639,37.3174340889091,36.8939906212759,36.9625931942444,95896584.0],["AAPL","2017-10-19",156.75,157.08,155.02,155.98,42584166.0,0.0,1.0,37.080873492466,37.1589384892922,36.6716236606193,36.8987218332047,170336664.0],["AAPL","2017-10-18",160.42,160.71,159.6,159.76,16374164.0,0.0,1.0,37.9490508814124,38.0176534543809,37.755071192329,37.7929208877599,65496656.0],["AAPL","2017-10-17",159.78,160.87,159.23,160.47,18997275.0,0.0,1.0,37.7976520996888,38.0555031498118,37.667543771645,37.9608789112345,75989100.0],["AAPL","2017-10-16",157.9,160.0,157.65,159.88,24121452.0,0.0,1.0,37.3529181783756,37.8496954309063,37.2937780292648,37.8213081593331,96485808.0],["AAPL","2017-10-13",156.73,157.28,156.41,156.99,16394188.0,0.0,1.0,37.0761422805371,37.2062506085809,37.0004428896753,37.1376480356123,65576752.0],["AAPL","2017-10-12",156.35,157.37,155.7299,156.0,16125054.0,0.0,1.0,36.9862492538887,37.2275410622607,36.8395580280343,36.9034530451336,64500216.0],["AAPL","2017-10-11",155.97,156.98,155.75,156.55,16905640.0,0.0,1.0,36.8963562272403,37.1352824296479,36.8443128960228,37.0335613731773,67622560.0],["AAPL","2017-10-10",156.055,158.0,155.1,155.9,15617014.0,0.0,1.0,36.916463877938,37.3765742380199,36.6905485083348,36.8797969854893,62468056.0],["AAPL","2017-10-09",155.81,156.73,155.485,155.84,16262923.0,0.0,1.0,36.8585065318094,37.0761422805371,36.7816243379654,36.8656033497027,65051692.0],["AAPL","2017-10-06",154.97,155.49,154.56,155.3,17407558.0,0.0,1.0,36.6597956307971,36.7828071409476,36.5628057862554,36.7378606276234,69630232.0],["AAPL","2017-10-05",154.18,155.44,154.05,155.39,21283769.0,0.0,1.0,36.472912759607,36.7709791111254,36.4421598820694,36.7591510813033,85135076.0],["AAPL","2017-10-04",153.63,153.86,152.46,153.48,20163750.0,0.0,1.0,36.3428044315633,36.3972133687452,36.0660285337248,36.3073203420968,80655000.0],["AAPL","2017-10-03",154.01,155.09,153.91,154.48,16230293.0,0.0,1.0,36.4326974582117,36.6881829023703,36.4090413985674,36.54388093854,64921172.0],["AAPL","2017-10-02",154.26,154.45,152.72,153.81,18698842.0,0.0,1.0,36.4918376073225,36.5367841206467,36.1275342888,36.3853853389231,74795368.0]],"columns":[{"name":"ticker","type":"text"},{"name":"date","type":"Date"},{"name":"open","type":"double"},{"name":"high","type":"double"},{"name":"low","type":"double"},{"name":"close","type":"double"},{"name":"volume","type":"double"},{"name":"dividend","type":"double"},{"name":"split","type":"double"},{"name":"adj_open","type":"double"},{"name":"adj_high","type":"double"},{"name":"adj_low","type":"double"},{"name":"adj_close","type":"double"},{"name":"adj_volume","type":"double"}]},"meta":{"next_cursor_id":null}}`)
	_, err := parseResponseBody(body)
	if err != nil {
		t.Errorf("Failed to parse API response body")
	}
}
